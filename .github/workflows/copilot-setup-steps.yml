name: Copilot Setup Steps

# This workflow pre-installs dependencies in the Copilot coding agent environment.
# It runs before Copilot starts working on a task, saving time and reducing failures.
# See: https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/customizing-the-development-environment-for-copilot-coding-agent

on:
  workflow_dispatch: {}

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: "22"
          cache: "npm"
          cache-dependency-path: macro-calendar/package-lock.json

      - name: Install dependencies
        working-directory: macro-calendar
        run: npm ci

      - name: Setup Deno (for Edge Functions)
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.x

      - name: Install Supabase CLI
        run: |
          curl -fsSL https://github.com/supabase/cli/releases/latest/download/supabase_linux_amd64.tar.gz | tar -xz
          sudo mv supabase /usr/local/bin/
          supabase --version
